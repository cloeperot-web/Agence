
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TimeTravel Agency | L'Excellence Temporelle</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --font-serif: 'Playfair Display', serif;
      --font-sans: 'Inter', sans-serif;
    }
    body {
      background-color: #050505;
      color: #f5f5f1;
      font-family: var(--font-sans);
      overflow-x: hidden;
    }
    h1, h2, h3, .font-serif {
      font-family: var(--font-serif);
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .copper-glow {
      box-shadow: 0 0 20px rgba(184, 115, 51, 0.2);
    }
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }
    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
      100% { transform: translateY(0px); }
    }
    .animate-float {
      animation: float 6s ease-in-out infinite;
    }
  </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "@google/genai": "https://esm.sh/@google/genai@1.4.0",
    "htm": "https://esm.sh/htm@3.1.1",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
  <div id="root"></div>
  <script type="module">
    import React, { useState, useEffect, useMemo, useRef } from 'react';
    import ReactDOM from 'react-dom/client';
    import { GoogleGenAI } from '@google/genai';
    import htm from 'htm';

    const html = htm.bind(React.createElement);

    // --- DONN√âES ---
    const DESTINATIONS = [
      {
        id: 'paris-1889',
        name: 'Paris 1889',
        era: 'Belle √âpoque',
        year: '1889',
        color: '#1a2b4c',
        accentColor: '#b87333',
        description: 'Exposition Universelle & Belle √âpoque',
        longDescription: 'Plongez dans l\'effervescence de la fin du XIXe si√®cle. Paris est alors la capitale du monde, port√©e par l\'Exposition Universelle. Entre les fiacres et les premi√®res lumi√®res √©lectriques, assistez √† l\'inauguration de la Dame de Fer et vivez l\'insouciance artistique de Montmartre.',
        heroImage: 'https://res.cloudinary.com/deuwvbxen/image/upload/v1770288303/gemini-image-2_Photographie_ultra_r%C3%A9aliste_de_Paris_en_1889_vue_depuis_le_Champ-de-Mars_avec_l-0-2_cuhmqh.jpg',
        experiences: [
          "Ascension de la Tour Eiffel durant son mois inaugural",
          "Spectacle de cabaret au Moulin Rouge original",
          "Discussion avec les impressionnistes √† Montparnasse",
          "Exploration du Hall des Machines"
        ],
        risks: [
          "√âtiquette sociale stricte du XIXe si√®cle",
          "Densit√© de foule extr√™me durant l'Exposition",
          "Hygi√®ne urbaine en transition"
        ],
        safetyRules: [
          "Port de la tenue d'√©poque obligatoire (fournie)",
          "Interdiction de parler du futur ou de politique moderne",
          "Usage exclusif des Francs d'√©poque certifi√©s"
        ],
        bestTime: "De Mai √† Octobre, apog√©e de l'Exposition.",
        checklist: [
          "Costume trois-pi√®ces ou robe de soir√©e sur mesure",
          "Traducteur linguistique Fran√ßais (1880s Edition)",
          "Vaccins temporels contre les souches historiques",
          "Identit√© de couverture valid√©e par l'Agence"
        ],
        itinerary: [
          { time: "Jour 1", activity: "Arriv√©e au Hub Quai d'Orsay. D√Æner gastronomique au Procope." },
          { time: "Jour 2", activity: "Visite VIP de l'Exposition Universelle et ascension priv√©e." },
          { time: "Jour 3", activity: "Matin√©e artistique √† Montmartre et soir√©e au cabaret." }
        ]
      },
      {
        id: 'cretace-65m',
        name: 'Cr√©tac√© -65M',
        era: '√Çge des G√©ants',
        year: '65M BCE',
        color: '#1b3a1b',
        accentColor: '#ffbf00',
        description: 'Safari pr√©historique & Nature sauvage',
        longDescription: 'Un monde sans homme, o√π l\'oxyg√®ne pur et les volcans actifs fa√ßonnent un paysage grandiose. Observez les titans de la Terre depuis nos sph√®res de protection invisibles. Une immersion brute au c≈ìur de la cha√Æne alimentaire la plus redoutable de l\'histoire.',
        heroImage: 'https://res.cloudinary.com/deuwvbxen/image/upload/v1770288306/Gemini_Generated_Image_q2mftkq2mftkq2mf_ddmigv.png',
        experiences: [
          "Survol par drone d'une colonie d'Hadrosaures",
          "Observation nocturne des pr√©dateurs Alpha",
          "Safari botanique (√©chantillonnage √† distance)",
          "Exploration sous-marine des Mosasaures"
        ],
        risks: [
          "M√©gafaune ultra-sensible au mouvement",
          "Taux d'oxyg√®ne √©lev√© (risque de vertiges)",
          "Risques de contamination biologique stricte"
        ],
        safetyRules: [
          "Interdiction stricte de quitter la sph√®re d'observation",
          "Politique 'Z√©ro Empreinte' : aucun d√©chet laiss√© sur place",
          "Flash photo interdit (peut provoquer les pr√©dateurs)"
        ],
        bestTime: "Printemps cr√©tac√©, p√©riode des grandes migrations.",
        checklist: [
          "Respirateur √† oxyg√®ne filtr√©",
          "G√©n√©rateur de champ de camouflage statique",
          "Combinaison de protection Bio-Risk Niveau 5",
          "Spray de masquage de ph√©romones"
        ],
        itinerary: [
          { time: "Jour 1", activity: "Insertion dans la formation Hell Creek. Installation du camp suspendu." },
          { time: "Jour 2", activity: "Suivi longue distance d'un groupe familial de T-Rex." },
          { time: "Jour 3", activity: "Observation des nids de Pt√©rosaures sur les falaises c√¥ti√®res." }
        ]
      },
      {
        id: 'florence-1504',
        name: 'Florence 1504',
        era: 'Haute Renaissance',
        year: '1504',
        color: '#4a0e0e',
        accentColor: '#cfb53b',
        description: '√Çge d\'Or des Arts et de l\'Esprit',
        longDescription: 'D√©couvrez le berceau de l\'humanisme. Florence en 1504 est le th√©√¢tre d\'une rivalit√© g√©niale entre Michel-Ange et L√©onard de Vinci. Arpentez les places pav√©es, visitez les ateliers secrets et vivez l\'effervescence politique et artistique de la cit√© des M√©dicis.',
        heroImage: 'https://res.cloudinary.com/deuwvbxen/image/upload/v1770288309/Gemini_Generated_Image_5gv6mp5gv6mp5gv6_oqb55m.png',
        experiences: [
          "Vue priv√©e du David de Michel-Ange fra√Æchement d√©voil√©",
          "Visite infiltr√©e de l'atelier de L√©onard de Vinci",
          "Gala exclusif au Palazzo Vecchio",
          "D√©gustation de vins historiques en Toscane"
        ],
        risks: [
          "Instabilit√© politique et espionnage fr√©quent",
          "Z√®le religieux (prudence sur les sujets philosophiques)",
          "Risques √©pid√©miques locaux p√©riodiques"
        ],
        safetyRules: [
          "Ma√Ætrise du dialecte Florentin requise (Niveau B2)",
          "Aucun m√©dicament futuriste ne doit √™tre expos√©",
          "√âviter les contacts prolong√©s avec les agents Borgia"
        ],
        bestTime: "Le printemps toscan, durant le Calcio Storico.",
        checklist: [
          "Doublet ou robe de soie du XVIe si√®cle",
          "Florins d'or certifi√©s par la Banque Temporelle",
          "St√©rilisateur UV portatif pour alimentation",
          "Carnet de croquis avec micro-enregistreur"
        ],
        itinerary: [
          { time: "Jour 1", activity: "Arriv√©e via Santa Maria Novella. R√©ception √† l'Auberge du Sanglier." },
          { time: "Jour 2", activity: "Exploration des ateliers de la Seigneurie et des places publiques." },
          { time: "Jour 3", activity: "Excursion dans les vignobles et coucher de soleil sur le Duomo." }
        ]
      }
    ];

    // --- COMPOSANTS ---

    const Header = ({ onNavigate, active }) => {
      const [scrolled, setScrolled] = useState(false);
      useEffect(() => {
        const h = () => setScrolled(window.scrollY > 20);
        window.addEventListener('scroll', h);
        return () => window.removeEventListener('scroll', h);
      }, []);

      return html`
        <nav className=${`fixed top-0 inset-x-0 z-50 transition-all duration-500 py-6 px-8 ${scrolled ? 'bg-black/90 backdrop-blur-lg shadow-xl py-4' : 'bg-transparent'}`}>
          <div className="max-w-7xl mx-auto flex justify-between items-center">
            <div onClick=${() => onNavigate('home')} className="flex items-center gap-3 cursor-pointer group">
              <div className="w-10 h-10 border-2 border-[#b87333] rounded-full flex items-center justify-center transition-transform group-hover:rotate-180 duration-700">
                <div className="w-1 h-4 bg-[#b87333] rotate-45 rounded-full"></div>
              </div>
              <span className="text-2xl font-serif tracking-tight">TimeTravel Agency</span>
            </div>
            <div className="hidden md:flex gap-10">
              ${['home', 'destinations', 'booking'].map(p => html`
                <button key=${p} onClick=${() => onNavigate(p)} className=${`uppercase text-xs tracking-[0.2em] hover:text-[#b87333] transition-colors ${active === p ? 'text-[#b87333]' : 'text-gray-400'}`}>
                  ${p === 'home' ? 'Accueil' : p === 'destinations' ? 'Destinations' : 'R√©server'}
                </button>
              `)}
            </div>
            <button onClick=${() => onNavigate('booking')} className="bg-[#b87333]/10 border border-[#b87333]/40 px-6 py-2 rounded-full text-xs uppercase tracking-widest hover:bg-[#b87333] transition-all">
              Voyager
            </button>
          </div>
        </nav>
      `;
    };

    const Hero = ({ onExplore }) => html`
      <div className="relative h-screen flex items-center justify-center overflow-hidden">
        <div className="absolute inset-0 bg-gradient-to-b from-black/40 via-transparent to-black z-10"></div>
        <img src="https://picsum.photos/id/1029/1920/1080" className="absolute inset-0 w-full h-full object-cover scale-105 opacity-50" alt="" />
        <div className="relative z-20 text-center px-6 max-w-4xl space-y-8">
          <h1 className="text-6xl md:text-8xl font-serif leading-tight">L'histoire <br /><span className="italic text-[#b87333]">n'est plus</span> un concept.</h1>
          <p className="text-xl md:text-2xl text-gray-300 font-light max-w-2xl mx-auto leading-relaxed">Le pass√© vous attend. Nous ouvrons le portail. D√©couvrez l‚Äôhistoire avec l'excellence et la s√©curit√© de notre technologie exclusive.</p>
          <button onClick=${onExplore} className="bg-[#b87333] hover:bg-[#a6622b] px-12 py-5 rounded-full font-serif text-xl transition-all hover:scale-105 shadow-2xl">Explorer les √âpoques</button>
        </div>
      </div>
    `;

    const DestinationGrid = ({ onSelect }) => html`
      <div className="grid md:grid-cols-3 gap-10">
        ${DESTINATIONS.map(d => html`
          <div key=${d.id} onClick=${() => onSelect(d.id)} className="group relative aspect-[3/4] rounded-3xl overflow-hidden cursor-pointer shadow-2xl hover:scale-[1.02] transition-all duration-700">
            <img src=${d.heroImage} className="absolute inset-0 w-full h-full object-cover grayscale-[30%] group-hover:grayscale-0 transition-all duration-1000" alt=${d.name} />
            <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-transparent"></div>
            <div className="absolute bottom-0 p-8 space-y-2">
              <span className="text-[10px] uppercase tracking-[0.4em]" style=${{ color: d.accentColor }}>${d.era}</span>
              <h3 className="text-3xl font-serif">${d.name}</h3>
              <p className="text-sm text-gray-400 opacity-0 group-hover:opacity-100 translate-y-4 group-hover:translate-y-0 transition-all duration-500">${d.description}</p>
            </div>
          </div>
        `)}
      </div>
    `;

    const DestinationDetail = ({ d, onBack, onBook }) => html`
      <div className="min-h-screen pb-20">
        <div className="relative h-[60vh]">
          <img src=${d.heroImage} className="w-full h-full object-cover" alt="" />
          <div className="absolute inset-0 bg-gradient-to-b from-transparent to-black"></div>
          <div className="absolute bottom-0 max-w-7xl mx-auto px-8 w-full pb-16">
            <button onClick=${onBack} className="text-xs uppercase tracking-widest text-white/60 mb-8 flex items-center gap-2 hover:text-white transition-colors">
              <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
              Retour aux destinations
            </button>
            <span className="text-xs uppercase tracking-[0.5em] mb-2 block" style=${{ color: d.accentColor }}>${d.era}</span>
            <h1 className="text-7xl font-serif mb-4">${d.name}</h1>
            <p className="text-2xl text-gray-300 italic font-light max-w-2xl">${d.description}</p>
          </div>
        </div>
        <div className="max-w-7xl mx-auto px-8 grid md:grid-cols-3 gap-20 mt-20">
          <div className="md:col-span-2 space-y-16">
            <section className="space-y-6">
              <h2 className="text-4xl font-serif">Une immersion totale</h2>
              <p className="text-lg text-gray-400 leading-relaxed font-light">${d.longDescription}</p>
            </section>
            <section className="space-y-8">
              <h2 className="text-3xl font-serif">Votre Itin√©raire</h2>
              <div className="space-y-8">
                ${d.itinerary.map((i, idx) => html`
                  <div key=${idx} className="flex gap-8 items-start relative pl-8 border-l border-white/10">
                    <div className="absolute left-[-5px] top-2 w-2 h-2 rounded-full bg-[#b87333]"></div>
                    <div>
                      <span className="text-xs uppercase tracking-widest text-gray-500">${i.time}</span>
                      <h4 className="text-xl text-white mt-1">${i.activity}</h4>
                    </div>
                  </div>
                `)}
              </div>
            </section>
          </div>
          <aside className="space-y-12">
            <div className="glass-card p-8 rounded-3xl space-y-6 border-[#b87333]/30">
              <h3 className="text-xl font-serif">Planifier ce voyage</h3>
              <p className="text-sm italic text-gray-400">"${d.bestTime} est la p√©riode id√©ale pour garantir une immersion optimale sans perturbation temporelle."</p>
              <button onClick=${onBook} className="w-full bg-[#b87333] py-4 rounded-full font-serif text-lg hover:bg-[#a6622b] transition-all shadow-xl">R√©server mon d√©part</button>
            </div>
            <div className="space-y-8">
              <div>
                <h4 className="text-red-400 font-serif mb-4 flex items-center gap-2">‚ö†Ô∏è √âvaluation des risques</h4>
                <ul className="space-y-3 text-sm text-gray-400">
                  ${d.risks.map((r, i) => html`<li key=${i} className="italic">‚Ä¢ ${r}</li>`)}
                </ul>
              </div>
              <div>
                <h4 className="text-white font-serif mb-4 flex items-center gap-2">üìã Liste de contr√¥le</h4>
                <ul className="space-y-3 text-sm text-gray-400">
                  ${d.checklist.map((c, i) => html`<li key=${i} className="flex gap-2"><input type="checkbox" className="accent-[#b87333]"/> ${c}</li>`)}
                </ul>
              </div>
            </div>
          </aside>
        </div>
      </div>
    `;

    const BookingFlow = ({ initialId, onDone, onCancel }) => {
      const [step, setStep] = useState(1);
      const [p, setP] = useState({
        eraId: initialId || DESTINATIONS[0].id,
        duration: 3,
        budget: 'premium',
        riskLevel: 'safe',
        interests: []
      });

      const renderStep = () => {
        if (step === 1) return html`
          <div className="space-y-10">
            <h2 className="text-4xl font-serif text-center">Vos Pr√©f√©rences</h2>
            <div className="grid md:grid-cols-2 gap-10">
              <div className="space-y-4">
                <label className="text-xs uppercase tracking-widest text-gray-500">Destination</label>
                <select value=${p.eraId} onChange=${e => setP({...p, eraId: e.target.value})} className="w-full bg-white/5 border border-white/10 p-4 rounded-xl text-white outline-none focus:border-[#b87333]">
                  ${DESTINATIONS.map(d => html`<option key=${d.id} value=${d.id} className="bg-black">${d.name}</option>`)}
                </select>
              </div>
              <div className="space-y-4">
                <label className="text-xs uppercase tracking-widest text-gray-500">Dur√©e : ${p.duration} Jours</label>
                <input type="range" min="1" max="14" value=${p.duration} onChange=${e => setP({...p, duration: parseInt(e.target.value)})} className="w-full accent-[#b87333]" />
              </div>
              <div className="space-y-4">
                <label className="text-xs uppercase tracking-widest text-gray-500">Budget</label>
                <div className="flex gap-4">
                  ${['standard', 'premium', 'ultimate'].map(b => html`
                    <button key=${b} onClick=${() => setP({...p, budget: b})} className=${`flex-1 py-3 rounded-lg border transition-all uppercase text-[10px] tracking-widest ${p.budget === b ? 'bg-[#b87333] border-[#b87333]' : 'border-white/10 text-gray-500'}`}>${b}</button>
                  `)}
                </div>
              </div>
              <div className="space-y-4">
                <label className="text-xs uppercase tracking-widest text-gray-500">Centres d'int√©r√™t</label>
                <div className="flex flex-wrap gap-2">
                  ${['Art', 'Science', 'Nature', 'Gastronomie', 'Aventure'].map(i => html`
                    <button key=${i} onClick=${() => setP({...p, interests: p.interests.includes(i) ? p.interests.filter(x => x !== i) : [...p.interests, i]})} className=${`px-4 py-2 rounded-full text-[10px] uppercase tracking-widest border transition-all ${p.interests.includes(i) ? 'bg-white text-black border-white' : 'border-white/10 text-gray-500'}`}>${i}</button>
                  `)}
                </div>
              </div>
            </div>
          </div>
        `;
        if (step === 2) return html`
          <div className="space-y-10">
            <h2 className="text-4xl font-serif text-center">Plan de Voyage Propos√©</h2>
            <div className="glass-card p-10 rounded-3xl max-w-2xl mx-auto space-y-8 border-[#b87333]/30">
              <div className="flex justify-between items-end border-b border-white/10 pb-6">
                <div>
                  <h3 className="text-3xl font-serif">${DESTINATIONS.find(d => d.id === p.eraId)?.name}</h3>
                  <p className="text-gray-400 italic">Immersion de ${p.duration} jours standards</p>
                </div>
                <div className="text-right">
                  <span className="text-xs text-gray-500">ESTIMATION</span>
                  <div className="text-3xl font-serif text-[#b87333]">‚Ç≥ ${p.duration * 4500}</div>
                </div>
              </div>
              <div className="grid grid-cols-2 gap-8 text-sm">
                <div className="space-y-2">
                  <h4 className="text-[#b87333] uppercase text-xs tracking-widest">Inclusions</h4>
                  <p className="text-gray-400 font-light">‚Ä¢ Bio-Impr√©gnation sensorielle<br/>‚Ä¢ Monnaie locale certifi√©e<br/>‚Ä¢ Guide digital discret</p>
                </div>
                <div className="space-y-2">
                  <h4 className="text-[#b87333] uppercase text-xs tracking-widest">S√©curit√©</h4>
                  <p className="text-gray-400 font-light">‚Ä¢ Protocole de non-ing√©rence<br/>‚Ä¢ Bulle de r√©alit√© Chronos<br/>‚Ä¢ Extraction prioritaire 24/7</p>
                </div>
              </div>
            </div>
          </div>
        `;
        return html`
          <div className="space-y-10">
            <h2 className="text-4xl font-serif text-center">Confirmation du Flux</h2>
            <div className="max-w-md mx-auto space-y-6">
              <input type="text" placeholder="Nom Complet du Voyageur" className="w-full bg-white/5 border border-white/10 p-4 rounded-xl text-white outline-none focus:border-[#b87333]" />
              <input type="email" placeholder="Canal de communication (Email)" className="w-full bg-white/5 border border-white/10 p-4 rounded-xl text-white outline-none focus:border-[#b87333]" />
              <div className="p-4 bg-yellow-900/10 border border-yellow-700/30 rounded-xl text-[10px] text-yellow-600 italic">
                En confirmant, vous acceptez les clauses d'indemnit√© paradoxale et le protocole de s√©curit√© temporelle (Rev. 2084.2).
              </div>
            </div>
          </div>
        `;
      };

      return html`
        <div className="max-w-4xl mx-auto px-8 pt-32 pb-20">
          <div className="flex justify-between mb-16 relative">
            <div className="absolute top-5 left-0 right-0 h-[2px] bg-white/5 -z-10"></div>
            ${[1,2,3].map(s => html`
              <div key=${s} className=${`w-10 h-10 rounded-full flex items-center justify-center font-serif border transition-all ${step >= s ? 'bg-[#b87333] border-[#b87333] text-white' : 'bg-black border-white/10 text-gray-600'}`}>${s}</div>
            `)}
          </div>
          ${renderStep()}
          <div className="flex justify-between mt-16 pt-8 border-t border-white/10">
            <button onClick=${step === 1 ? onCancel : () => setStep(step - 1)} className="text-gray-500 hover:text-white transition-colors">${step === 1 ? 'Annuler' : 'Pr√©c√©dent'}</button>
            <button onClick=${step === 3 ? () => onDone(p) : () => setStep(step + 1)} className="bg-white text-black px-10 py-3 rounded-full font-medium hover:bg-[#b87333] hover:text-white transition-all">${step === 3 ? 'Confirmer le Voyage' : 'Continuer'}</button>
          </div>
        </div>
      `;
    };

    const ChatWidget = () => {
      const [open, setOpen] = useState(false);
      const [input, setInput] = useState('');
      const [isTyping, setIsTyping] = useState(false);
      const [msgs, setMsgs] = useState([{ role: 'assistant', content: 'Salutations, Voyageur. Je suis Chronos-01. Quelle √©poque vous inspire aujourd‚Äôhui ?' }]);
      const endRef = useRef(null);

      useEffect(() => endRef.current?.scrollIntoView({ behavior: 'smooth' }), [msgs, isTyping]);

      const send = async () => {
        if (!input.trim() || isTyping) return;
        const userMsg = { role: 'user', content: input };
        setMsgs(p => [...p, userMsg]);
        setInput('');
        setIsTyping(true);
        try {
          // Utilisation de process.env.API_KEY ou fallback vide
          const apiKey = typeof process !== 'undefined' ? process.env.API_KEY : '';
          const ai = new GoogleGenAI({ apiKey });
          const res = await ai.models.generateContent({
            model: 'gemini-3-flash-preview',
            contents: [...msgs, userMsg].map(m => ({ role: m.role === 'assistant' ? 'model' : 'user', parts: [{ text: m.content }] })),
            config: {
              systemInstruction: `Tu es Chronos-01, l'assistant expert de TimeTravel Agency. Ton ton est prestigieux, enthousiaste et s√©curitaire. Parle uniquement en fran√ßais. Explique les destinations (Paris 1889, Cr√©tac√©, Florence 1504), les prix (~4500-12500‚Ç≥), et donne des conseils de s√©curit√©. Utilise le terme "Chronos-Field" pour la s√©curit√© temporelle.`
            }
          });
          setMsgs(p => [...p, { role: 'assistant', content: res.text || "La connexion temporelle est faible..." }]);
        } catch (e) { 
          setMsgs(p => [...p, { role: 'assistant', content: "Erreur de connexion temporelle. Veuillez v√©rifier la configuration de l'API." }]); 
        }
        setIsTyping(false);
      };

      return html`
        <div className="fixed bottom-8 right-8 z-[100]">
          ${open ? html`
            <div className="glass-card w-[360px] h-[500px] rounded-3xl flex flex-col shadow-2xl overflow-hidden border-[#b87333]/30">
              <div className="bg-[#b87333] p-5 flex justify-between items-center text-white">
                <span className="font-serif">Chronos-01</span>
                <button onClick=${() => setOpen(false)}><svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
              </div>
              <div className="flex-1 p-5 overflow-y-auto space-y-4 no-scrollbar">
                ${msgs.map((m, i) => html`
                  <div key=${i} className=${`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                    <div className=${`max-w-[85%] p-3 rounded-2xl text-sm ${m.role === 'user' ? 'bg-[#b87333]/20 border border-[#b87333]/30 text-white rounded-tr-none' : 'bg-black/40 border border-white/5 text-gray-300 rounded-tl-none'}`}>${m.content}</div>
                  </div>
                `)}
                ${isTyping && html`<div className="text-xs text-gray-500 italic">Chronos-01 analyse le flux...</div>`}
                <div ref=${endRef}></div>
              </div>
              <div className="p-4 bg-black/40 border-t border-white/5 flex gap-2">
                <input type="text" value=${input} onChange=${e => setInput(e.target.value)} onKeyDown=${e => e.key === 'Enter' && send()} placeholder="Posez vos questions..." className="flex-1 bg-white/5 border border-white/10 rounded-full px-4 py-2 text-sm outline-none focus:border-[#b87333]" />
                <button onClick=${send} className="w-10 h-10 rounded-full bg-[#b87333] flex items-center justify-center text-white"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg></button>
              </div>
            </div>
          ` : html`
            <button onClick=${() => setOpen(true)} className="w-14 h-14 bg-[#b87333] rounded-full flex items-center justify-center text-white shadow-2xl hover:scale-110 transition-transform animate-float">
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/></svg>
            </button>
          `}
        </div>
      `;
    };

    const App = () => {
      const [page, setPage] = useState('home');
      const [selId, setSelId] = useState(null);

      const selectedD = useMemo(() => DESTINATIONS.find(d => d.id === selId), [selId]);

      useEffect(() => window.scrollTo({ top: 0, behavior: 'smooth' }), [page, selId]);

      const navigate = (p, id) => {
        if (id) setSelId(id);
        setPage(p);
      };

      const render = () => {
        if (page === 'home') return html`
          <div className="space-y-32">
            <${Hero} onExplore=${() => setPage('destinations')} />
            <section className="max-w-7xl mx-auto px-8 grid md:grid-cols-2 gap-16 items-center">
              <div className="space-y-8">
                <h2 className="text-5xl font-serif">L'Excellence √† travers les √Çges</h2>
                <p className="text-lg text-gray-400 font-light leading-relaxed">Depuis 2084, TimeTravel Agency red√©finit l'exp√©rience du voyage. Notre technologie de confinement temporel vous permet d'observer les moments cl√©s de l'humanit√© sans risque de paradoxe.</p>
                <div className="grid grid-cols-2 gap-6">
                  <div className="p-6 border border-white/10 rounded-2xl"><span className="text-2xl font-serif text-[#b87333]">32</span><p className="text-[10px] uppercase tracking-widest text-gray-500 mt-1">√âpoques Mapp√©es</p></div>
                  <div className="p-6 border border-white/10 rounded-2xl"><span className="text-2xl font-serif text-[#b87333]">100%</span><p className="text-[10px] uppercase tracking-widest text-gray-500 mt-1">S√©curit√© Temporelle</p></div>
                </div>
              </div>
              <div className="relative group">
                <img src="https://picsum.photos/id/1041/800/1000" className="rounded-3xl grayscale hover:grayscale-0 transition-all duration-1000 shadow-2xl" alt="" />
              </div>
            </section>
            <section className="max-w-7xl mx-auto px-8 pb-32 space-y-16">
              <div className="text-center space-y-4">
                <h2 className="text-5xl font-serif">Destinations Pris√©es</h2>
                <p className="text-gray-500 italic">Une s√©lection rigoureuse des √©poques les plus fascinantes.</p>
              </div>
              <${DestinationGrid} onSelect=${id => navigate('detail', id)} />
            </section>
          </div>
        `;
        if (page === 'destinations') return html`
          <div className="pt-32 px-8 max-w-7xl mx-auto pb-32 space-y-16">
            <h1 className="text-6xl font-serif text-center">Horizons Temporels</h1>
            <${DestinationGrid} onSelect=${id => navigate('detail', id)} />
          </div>
        `;
        if (page === 'detail' && selectedD) return html`<${DestinationDetail} d=${selectedD} onBack=${() => setPage('destinations')} onBook=${() => setPage('booking')} />`;
        if (page === 'booking') return html`<${BookingFlow} initialId=${selId} onCancel=${() => setPage('home')} onDone=${() => setPage('confirmation')} />`;
        if (page === 'confirmation') return html`
          <div className="min-h-screen flex items-center justify-center pt-20 px-8 text-center">
            <div className="max-w-2xl space-y-10">
              <div className="w-24 h-24 bg-green-900/20 border border-green-500 rounded-full flex items-center justify-center mx-auto"><svg className="w-12 h-12 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7"/></svg></div>
              <h1 className="text-6xl font-serif">D√©part Confirm√©</h1>
              <p className="text-xl text-gray-400 italic">"Le flux temporel est pr√™t pour votre insertion. Pr√©parez-vous au transfert."</p>
              <div className="glass-card p-8 rounded-3xl text-left space-y-4">
                <h3 className="font-serif text-xl border-b border-white/10 pb-2">Billet Temporel #TTA-2084</h3>
                <p><span className="text-gray-500">Destination :</span> ${selectedD?.name || 'S√©lectionn√©e'}</p>
                <p><span className="text-gray-500">S√©curit√© :</span> Chronos-Field‚Ñ¢ Activ√©</p>
                <button onClick=${() => setPage('home')} className="w-full bg-white text-black py-3 rounded-full mt-4 font-medium hover:bg-[#b87333] hover:text-white transition-all">Retour √† l'Agence</button>
              </div>
            </div>
          </div>
        `;
        return null;
      };

      return html`
        <div className="min-h-screen">
          <${Header} onNavigate=${navigate} active=${page} />
          <main>${render()}</main>
          <${ChatWidget} />
          <footer className="bg-black/80 border-t border-white/5 py-20 px-8">
            <div className="max-w-7xl mx-auto grid md:grid-cols-3 gap-16">
              <div className="space-y-6">
                <h3 className="text-xl font-serif">TimeTravel Agency</h3>
                <p className="text-sm text-gray-500 font-light leading-relaxed">Ouvrir les portes de l'histoire avec √©l√©gance et responsabilit√©. Membre fondateur de la Coalition Temporelle.</p>
              </div>
              <div className="space-y-4">
                <h4 className="text-xs uppercase tracking-widest text-[#b87333]">L√©gal</h4>
                <ul className="text-sm text-gray-500 space-y-2">
                  <li>Protocole Paradoxal</li><li>Code de Conduite 1889</li><li>Clause de Non-Interf√©rence</li>
                </ul>
              </div>
              <div className="space-y-4">
                <h4 className="text-xs uppercase tracking-widest text-[#b87333]">Contact</h4>
                <p className="text-sm text-gray-500">Quai d'Orsay, Station Chronos<br/>Paris, Flux 2084</p>
              </div>
            </div>
          </footer>
        </div>
      `;
    };

    const rootElement = document.getElementById('root');
    const root = ReactDOM.createRoot(rootElement);
    root.render(React.createElement(App));
  </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
